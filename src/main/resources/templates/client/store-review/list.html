<!DOCTYPE html>
<html lang="uk" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <title>Відгуки про магазин</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
<div class="container mt-4">

  <!-- Сообщения об успехе/ошибке -->
  <div th:if="${successMessage}" class="alert alert-success alert-dismissible fade show">
    <span th:text="${successMessage}"></span>
    <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
  </div>

  <div th:if="${errorMessage}" class="alert alert-danger alert-dismissible fade show">
    <span th:text="${errorMessage}"></span>
    <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
  </div>

  <h1 class="mb-4">Відгуки про магазин</h1>

  <!-- Форма добавления отзыва -->
  <div class="card mb-4">
    <div class="card-header">
      <h5>Залишити відгук</h5>
    </div>
    <div class="card-body">
      <form th:action="@{/store-review}" th:object="${form}" method="post">

        <div class="mb-3">
          <label for="name" class="form-label">Ім'я *</label>
          <input type="text" th:field="*{name}" class="form-control"
                 th:classappend="${#fields.hasErrors('name')} ? 'is-invalid' : ''"
                 id="name" placeholder="Введіть ваше ім'я">
          <div th:if="${#fields.hasErrors('name')}" class="invalid-feedback">
            <span th:errors="*{name}"></span>
          </div>
        </div>

        <div class="mb-3">
          <label for="rating" class="form-label">Оцінка *</label>
          <select th:field="*{rating}" class="form-select"
                  th:classappend="${#fields.hasErrors('rating')} ? 'is-invalid' : ''"
                  id="rating">
            <option value="">Оберіть оцінку</option>
            <option value="1">⭐ 1 зірка</option>
            <option value="2">⭐⭐ 2 зірки</option>
            <option value="3">⭐⭐⭐ 3 зірки</option>
            <option value="4">⭐⭐⭐⭐ 4 зірки</option>
            <option value="5">⭐⭐⭐⭐⭐ 5 зірок</option>
          </select>
          <div th:if="${#fields.hasErrors('rating')}" class="invalid-feedback">
            <span th:errors="*{rating}"></span>
          </div>
        </div>

        <div class="mb-3">
          <label for="comment" class="form-label">Коментар *</label>
          <textarea th:field="*{comment}" class="form-control"
                    th:classappend="${#fields.hasErrors('comment')} ? 'is-invalid' : ''"
                    id="comment" rows="4"
                    placeholder="Поділіться вашими враженнями..."></textarea>
          <div th:if="${#fields.hasErrors('comment')}" class="invalid-feedback">
            <span th:errors="*{comment}"></span>
          </div>
        </div>

        <button type="submit" class="btn btn-primary">Додати відгук</button>
      </form>
    </div>
  </div>

  <!-- Список отзывов -->
  <div class="row">
    <div th:each="review : ${pagedResponse.content}" class="col-12 mb-3">
      <div class="card">
        <div class="card-body">
          <div class="d-flex justify-content-between align-items-start">
            <div>
              <h6 class="card-title" th:text="${review.name}"></h6>
              <div class="mb-2">
                <span th:text="${review.starsDisplay}" class="text-warning"></span>
              </div>
              <p class="card-text" th:text="${review.comment}"></p>
            </div>
            <div class="text-muted">
              <small th:text="${#temporals.format(review.created, 'dd.MM.yyyy HH:mm')}"></small>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Пагинация -->
  <nav th:if="${pagedResponse.metadata.totalPages > 1}">
    <ul class="pagination justify-content-center">

      <!-- Предыдущая страница -->
      <li class="page-item" th:classappend="${!pagedResponse.metadata.hasPrevious} ? 'disabled'">
        <a class="page-link"
           th:href="@{/store-review(page=${pagedResponse.metadata.page - 1}, size=${pagedResponse.metadata.size})}">
          Попередня
        </a>
      </li>

      <!-- Номера страниц -->
      <li th:each="pageNum : ${#numbers.sequence(0, pagedResponse.metadata.totalPages - 1)}"
          class="page-item"
          th:classappend="${pageNum == pagedResponse.metadata.page} ? 'active'">
        <a class="page-link"
           th:href="@{/store-review(page=${pageNum}, size=${pagedResponse.metadata.size})}"
           th:text="${pageNum + 1}"></a>
      </li>

      <!-- Следующая страница -->
      <li class="page-item" th:classappend="${!pagedResponse.metadata.hasNext} ? 'disabled'">
        <a class="page-link"
           th:href="@{/store-review(page=${pagedResponse.metadata.page + 1}, size=${pagedResponse.metadata.size})}">
          Наступна
        </a>
      </li>
    </ul>
  </nav>

  <!-- Информация о пагинации -->
  <div class="text-center text-muted mt-3" th:if="${pagedResponse.metadata.totalElements > 0}">
    Показано <span th:text="${pagedResponse.content.size()}"></span> з
    <span th:text="${pagedResponse.metadata.totalElements}"></span> відгуків
  </div>

  <div class="text-center text-muted mt-3" th:if="${pagedResponse.metadata.totalElements == 0}">
    Відгуків поки що немає. Станьте першим!
  </div>

</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>