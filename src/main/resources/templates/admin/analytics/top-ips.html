<!DOCTYPE html>
<html lang="uk" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>–¢–æ–ø IP –∞–¥—Ä–µ—Å–æ–≤ - –ê–Ω–∞–ª–∏—Ç–∏–∫–∞</title>
</head>
<body>

<h1>–¢–æ–ø IP –∞–¥—Ä–µ—Å–æ–≤</h1>

<!-- –ù–∞–≤–∏–≥–∞—Ü–∏—è -->
<p>
  <a href="/analytics">‚Üê –ù–∞–∑–∞–¥ –∫ –∞–Ω–∞–ª–∏—Ç–∏–∫–µ</a> |
  <a href="/analytics/countries">–°—Ç—Ä–∞–Ω—ã</a> |
  <a href="/analytics/ip">–ü–æ–∏—Å–∫ –ø–æ IP</a>
</p>

<hr>

<!-- –°–µ–ª–µ–∫—Ç–æ—Ä –ø–µ—Ä–∏–æ–¥–∞ -->
<h2>–ü–µ—Ä–∏–æ–¥ –∞–Ω–∞–ª–∏–∑–∞</h2>
<p>
  <strong>–ü–æ–∫–∞–∑–∞—Ç—å –¥–∞–Ω–Ω—ã–µ –∑–∞:</strong>
  <a th:href="@{/analytics/top-ips(days=1)}"
     th:style="${selectedDays == 1} ? 'font-weight: bold; color: blue;' : ''">1 –¥–µ–Ω—å</a> |
  <a th:href="@{/analytics/top-ips(days=7)}"
     th:style="${selectedDays == 7} ? 'font-weight: bold; color: blue;' : ''">7 –¥–Ω–µ–π</a> |
  <a th:href="@{/analytics/top-ips(days=30)}"
     th:style="${selectedDays == 30} ? 'font-weight: bold; color: blue;' : ''">30 –¥–Ω–µ–π</a> |
  <a th:href="@{/analytics/top-ips(days=90)}"
     th:style="${selectedDays == 90} ? 'font-weight: bold; color: blue;' : ''">90 –¥–Ω–µ–π</a>
</p>

<hr>

<!-- –û–±—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
<h2>–û–±—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∑–∞ <span th:text="${selectedDays}">7</span> –¥–Ω–µ–π</h2>
<table border="1" cellpadding="5">
  <tr>
    <td><strong>–í—Å–µ–≥–æ –ø–æ—Å–µ—â–µ–Ω–∏–π:</strong></td>
    <td th:text="${totalVisits}">123</td>
  </tr>
  <tr>
    <td><strong>–£–Ω–∏–∫–∞–ª—å–Ω—ã—Ö IP:</strong></td>
    <td th:text="${uniqueIps}">45</td>
  </tr>
  <tr>
    <td><strong>–°—Ä–µ–¥–Ω–µ–µ –ø–æ—Å–µ—â–µ–Ω–∏–π –Ω–∞ IP:</strong></td>
    <td th:text="${uniqueIps > 0 ? #numbers.formatDecimal(totalVisits / uniqueIps, 1, 1) : 0}">2.7</td>
  </tr>
</table>

<hr>

<!-- –¢–æ–ø IP –∞–¥—Ä–µ—Å–æ–≤ -->
<h2>–¢–æ–ø 50 —Å–∞–º—ã—Ö –∞–∫—Ç–∏–≤–Ω—ã—Ö IP –∞–¥—Ä–µ—Å–æ–≤</h2>

<div th:if="${topIps != null and !topIps.isEmpty()}">
  <p><strong>–ù–∞–π–¥–µ–Ω–æ IP –∞–¥—Ä–µ—Å–æ–≤:</strong> <span th:text="${#lists.size(topIps)}">25</span></p>

  <table border="1" cellpadding="5" width="100%">
    <thead>
    <tr>
      <th>–ú–µ—Å—Ç–æ</th>
      <th>IP –ê–¥—Ä–µ—Å</th>
      <th>–ü–æ—Å–µ—â–µ–Ω–∏–π</th>
      <th>% –æ—Ç –æ–±—â–µ–≥–æ</th>
      <th>–°—Ç—Ä–∞–Ω–∞</th>
      <th>–ì–æ—Ä–æ–¥</th>
      <th>–î–µ–π—Å—Ç–≤–∏—è</th>
    </tr>
    </thead>
    <tbody>
    <tr th:each="ip, ipStat : ${topIps}">
      <td>
        <strong th:text="${ipStat.count}">1</strong>
      </td>
      <td>
        <code th:text="${ip[0]}">192.168.1.1</code>
      </td>
      <td>
        <strong th:text="${ip[1]}">25</strong>
      </td>
      <td>
        <span th:text="${#numbers.formatDecimal((ip[1] * 100.0 / totalVisits), 1, 1)} + '%'">15.5%</span>
      </td>
      <td>
        <span th:text="${ip[2] ?: 'Unknown'}">Ukraine</span>
      </td>
      <td>
        <span th:text="${ip[3] ?: 'Unknown'}">Kyiv</span>
      </td>
      <td>
        <a th:href="@{/analytics/ip(ip=${ip[0]})}">üìä –î–µ—Ç–∞–ª–∏</a>
      </td>
    </tr>
    </tbody>
  </table>

  <hr>

  <!-- –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
  <h3>–ê–Ω–∞–ª–∏–∑ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ IP</h3>
  <table border="1" cellpadding="5">
    <tr>
      <td><strong>–°–∞–º—ã–π –∞–∫—Ç–∏–≤–Ω—ã–π IP:</strong></td>
      <td>
        <code th:text="${topIps[0][0]}">192.168.1.1</code>
        (<span th:text="${topIps[0][1]}">50</span> –ø–æ—Å–µ—â–µ–Ω–∏–π)
      </td>
    </tr>
    <tr>
      <td><strong>IP —Å 1 –ø–æ—Å–µ—â–µ–Ω–∏–µ–º:</strong></td>
      <td>
        <span th:text="${#lists.size(#lists.select(topIps, ip -> ip[1] == 1))}">12</span>
        (<span th:text="${#numbers.formatDecimal((#lists.size(#lists.select(topIps, ip -> ip[1] == 1)) * 100.0 / #lists.size(topIps)), 1, 1)} + '%'">24%</span>)
      </td>
    </tr>
    <tr>
      <td><strong>IP —Å 5+ –ø–æ—Å–µ—â–µ–Ω–∏—è–º–∏:</strong></td>
      <td>
        <span th:text="${#lists.size(#lists.select(topIps, ip -> ip[1] >= 5))}">8</span>
        (<span th:text="${#numbers.formatDecimal((#lists.size(#lists.select(topIps, ip -> ip[1] >= 5)) * 100.0 / #lists.size(topIps)), 1, 1)} + '%'">16%</span>)
      </td>
    </tr>
  </table>

  <hr>

  <!-- –¢–æ–ø —Å—Ç—Ä–∞–Ω—ã –ø–æ IP -->
  <h3>–†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ —Å—Ç—Ä–∞–Ω–∞–º (—Ç–æ–ø IP)</h3>
  <table border="1" cellpadding="5">
    <thead>
    <tr>
      <th>–°—Ç—Ä–∞–Ω–∞</th>
      <th>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ IP</th>
      <th>% –æ—Ç —Ç–æ–ø–∞</th>
    </tr>
    </thead>
    <tbody>
    <!-- –ì—Ä—É–ø–ø–∏—Ä—É–µ–º –ø–æ —Å—Ç—Ä–∞–Ω–∞–º -->
    <tr th:each="country : ${#lists.toSet(#lists.select(topIps, ip -> ip[2]))}">
      <td th:text="${country ?: 'Unknown'}">Ukraine</td>
      <td th:text="${#lists.size(#lists.select(topIps, ip -> ip[2] == country))}">15</td>
      <td th:text="${#numbers.formatDecimal((#lists.size(#lists.select(topIps, ip -> ip[2] == country)) * 100.0 / #lists.size(topIps)), 1, 1)} + '%'">60%</td>
    </tr>
    </tbody>
  </table>

</div>

<!-- –ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö -->
<div th:if="${topIps == null or topIps.isEmpty()}">
  <h3 style="color: orange;">–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –∑–∞ –≤—ã–±—Ä–∞–Ω–Ω—ã–π –ø–µ—Ä–∏–æ–¥</h3>
  <p>–ó–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ <span th:text="${selectedDays}">7</span> –¥–Ω–µ–π –Ω–µ –±—ã–ª–æ –ø–æ—Å–µ—â–µ–Ω–∏–π.</p>
  <p>–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –≤—ã–±—Ä–∞—Ç—å –±–æ–ª—å—à–∏–π –ø–µ—Ä–∏–æ–¥ –∏–ª–∏ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–∞–±–æ—Ç—É —Å–∏—Å—Ç–µ–º—ã —Ç—Ä–µ–∫–∏–Ω–≥–∞.</p>
</div>

<!-- –û—à–∏–±–∫–∏ -->
<div th:if="${error}" style="color: red; border: 1px solid red; padding: 10px; margin: 10px 0;">
  <h3>–û—à–∏–±–∫–∞</h3>
  <p th:text="${error}">–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞</p>
</div>

<hr>

<!-- –ë—ã—Å—Ç—Ä—ã–µ –¥–µ–π—Å—Ç–≤–∏—è -->
<h3>–ë—ã—Å—Ç—Ä—ã–µ –¥–µ–π—Å—Ç–≤–∏—è</h3>
<ul>
  <li>
    <a href="/analytics/ip">üîç –ù–∞–π—Ç–∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π IP</a>
  </li>
  <li>
    <a th:href="@{/analytics/ip(ip=${topIps != null and !topIps.isEmpty() ? topIps[0][0] : ''})}">
      üìä –ü–æ–¥—Ä–æ–±–Ω–æ –æ —Å–∞–º–æ–º –∞–∫—Ç–∏–≤–Ω–æ–º IP
    </a>
  </li>
  <li>
    <a href="/analytics/countries">üåç –ê–Ω–∞–ª–∏–∑ –ø–æ —Å—Ç—Ä–∞–Ω–∞–º</a>
  </li>
  <li>
    <a href="/analytics">üìà –û–±—â–∞—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∞</a>
  </li>
</ul>

<hr>

<!-- –ü–æ—è—Å–Ω–µ–Ω–∏—è -->
<h3>–ü–æ—è—Å–Ω–µ–Ω–∏—è</h3>
<ul>
  <li><strong>IP –∞–¥—Ä–µ—Å</strong> - —É–Ω–∏–∫–∞–ª—å–Ω—ã–π –∞–¥—Ä–µ—Å —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ –≤ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–µ</li>
  <li><strong>–ü–æ—Å–µ—â–µ–Ω–∏—è</strong> - –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å—Ç—Ä–∞–Ω–∏—Ü, –∫–æ—Ç–æ—Ä—ã–µ –ø–æ—Å–µ—Ç–∏–ª –¥–∞–Ω–Ω—ã–π IP</li>
  <li><strong>% –æ—Ç –æ–±—â–µ–≥–æ</strong> - –¥–æ–ª—è –æ—Ç –≤—Å–µ—Ö –ø–æ—Å–µ—â–µ–Ω–∏–π –∑–∞ –ø–µ—Ä–∏–æ–¥</li>
  <li><strong>–î–µ—Ç–∞–ª–∏</strong> - –ø–æ–¥—Ä–æ–±–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –≤—Å–µ—Ö –ø–æ—Å–µ—â–µ–Ω–∏—è—Ö IP</li>
</ul>

<hr>

<p>
  <small>
    <a href="/analytics">‚Üê –í–µ—Ä–Ω—É—Ç—å—Å—è –∫ –≥–ª–∞–≤–Ω–æ–π –∞–Ω–∞–ª–∏—Ç–∏–∫–µ</a>
  </small>
</p>

</body>
</html>