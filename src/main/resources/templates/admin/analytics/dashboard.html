<!--<!DOCTYPE html>-->
<!--<html lang="uk" xmlns:th="http://www.thymeleaf.org">-->
<!--<head>-->
<!--    <meta charset="UTF-8">-->
<!--    <meta name="viewport" content="width=device-width, initial-scale=1.0">-->
<!--    <title>Аналитика посетителей - Панель управления</title>-->
<!--</head>-->
<!--<body>-->

<!--<h1>📊 Аналитика посетителей</h1>-->

<!--&lt;!&ndash; Навигация &ndash;&gt;-->
<!--<p>-->
<!--    <a href="/analytics/countries">🌍 Страны</a> |-->
<!--    <a href="/analytics/ip">🔍 Поиск по IP</a> |-->
<!--    <a href="/analytics/top-ips">👥 Топ IP</a> |-->
<!--    <a href="/analytics/visitors">📄 Все посетители</a>-->
<!--</p>-->

<!--<hr>-->

<!--&lt;!&ndash; Основная статистика &ndash;&gt;-->
<!--<h2>📈 Основная статистика</h2>-->
<!--<table border="2" cellpadding="10" width="100%">-->
<!--    <tr>-->
<!--        <td style="text-align: center; background-color: #e3f2fd;">-->
<!--            <h3>👥 Всего посещений</h3>-->
<!--            <strong style="font-size: 2em; color: #1976d2;" th:text="${stats.totalVisits ?: 0}">1,234</strong>-->
<!--            <br><small>За все время</small>-->
<!--        </td>-->
<!--        <td style="text-align: center; background-color: #e8f5e8;">-->
<!--            <h3>📅 За неделю</h3>-->
<!--            <strong style="font-size: 2em; color: #388e3c;" th:text="${stats.weeklyVisits ?: 0}">156</strong>-->
<!--            <br><small>Последние 7 дней</small>-->
<!--        </td>-->
<!--        <td style="text-align: center; background-color: #fff3e0;">-->
<!--            <h3>📱 Мобильных</h3>-->
<!--            <strong style="font-size: 2em; color: #f57c00;" th:text="${#numbers.formatDecimal(stats.mobilePercentage ?: 0, 1, 1)} + '%'">45.2%</strong>-->
<!--            <br><small>От всех посещений</small>-->
<!--        </td>-->
<!--        <td style="text-align: center; background-color: #f3e5f5;">-->
<!--            <h3>🕐 Сегодня</h3>-->
<!--            <strong style="font-size: 2em; color: #7b1fa2;" th:text="${todayVisits ?: 0}">23</strong>-->
<!--            <br><small>Уникальных: <span th:text="${todayUnique ?: 0}">15</span></small>-->
<!--        </td>-->
<!--    </tr>-->
<!--</table>-->

<!--<hr>-->

<!--&lt;!&ndash; Топ страны и страницы &ndash;&gt;-->
<!--<table width="100%">-->
<!--    <tr>-->
<!--        <td width="50%" valign="top">-->
<!--            &lt;!&ndash; Топ страны &ndash;&gt;-->
<!--            <h3>🌍 Топ страны (неделя)</h3>-->
<!--            <div th:if="${topCountries != null and !topCountries.isEmpty()}">-->
<!--                <table border="1" cellpadding="5" width="100%">-->
<!--                    <thead>-->
<!--                    <tr style="background-color: #f0f0f0;">-->
<!--                        <th>Место</th>-->
<!--                        <th>Страна</th>-->
<!--                        <th>Посещений</th>-->
<!--                    </tr>-->
<!--                    </thead>-->
<!--                    <tbody>-->
<!--                    <tr th:each="country, countryStat : ${topCountries}">-->
<!--                        <td style="text-align: center;">-->
<!--                            <strong th:text="${countryStat.count}">1</strong>-->
<!--                        </td>-->
<!--                        <td>-->
<!--                                    <span th:switch="${country[0]}">-->
<!--                                        <span th:case="'Ukraine'">🇺🇦</span>-->
<!--                                        <span th:case="'Poland'">🇵🇱</span>-->
<!--                                        <span th:case="'Germany'">🇩🇪</span>-->
<!--                                        <span th:case="'United States'">🇺🇸</span>-->
<!--                                        <span th:case="'Canada'">🇨🇦</span>-->
<!--                                        <span th:case="'France'">🇫🇷</span>-->
<!--                                        <span th:case="*">🌍</span>-->
<!--                                    </span>-->
<!--                            <strong th:text="${country[0] ?: 'Невідомо'}">Ukraine</strong>-->
<!--                        </td>-->
<!--                        <td style="text-align: center;">-->
<!--                            <strong th:text="${country[1]}">45</strong>-->
<!--                        </td>-->
<!--                    </tr>-->
<!--                    </tbody>-->
<!--                </table>-->
<!--            </div>-->
<!--            <div th:if="${topCountries == null or topCountries.isEmpty()}">-->
<!--                <p style="color: gray; text-align: center;">Поки немає даних по країнах</p>-->
<!--            </div>-->
<!--            <p><a href="/analytics/countries">📊 Детальна статистика по країнах →</a></p>-->
<!--        </td>-->

<!--        <td width="50%" valign="top">-->
<!--            &lt;!&ndash; Топ страницы &ndash;&gt;-->
<!--            <h3>📄 Популярні сторінки</h3>-->
<!--            <div th:if="${topPages != null and !topPages.isEmpty()}">-->
<!--                <table border="1" cellpadding="5" width="100%">-->
<!--                    <thead>-->
<!--                    <tr style="background-color: #f0f0f0;">-->
<!--                        <th>Место</th>-->
<!--                        <th>Страница</th>-->
<!--                        <th>Посещений</th>-->
<!--                    </tr>-->
<!--                    </thead>-->
<!--                    <tbody>-->
<!--                    <tr th:each="page, pageStat : ${topPages}">-->
<!--                        <td style="text-align: center;">-->
<!--                            <strong th:text="${pageStat.count}">1</strong>-->
<!--                        </td>-->
<!--                        <td>-->
<!--                            <code style="font-size: 0.9em;" th:text="${page[0] ?: '/'}"></code>-->
<!--                        </td>-->
<!--                        <td style="text-align: center;">-->
<!--                            <strong th:text="${page[1]}">12</strong>-->
<!--                        </td>-->
<!--                    </tr>-->
<!--                    </tbody>-->
<!--                </table>-->
<!--            </div>-->
<!--            <div th:if="${topPages == null or topPages.isEmpty()}">-->
<!--                <p style="color: gray; text-align: center;">Поки немає даних по сторінках</p>-->
<!--            </div>-->
<!--        </td>-->
<!--    </tr>-->
<!--</table>-->

<!--<hr>-->

<!--&lt;!&ndash; Последние посетители &ndash;&gt;-->
<!--<h2>👥 Останні відвідувачі</h2>-->

<!--&lt;!&ndash; Информация о пагинации &ndash;&gt;-->
<!--<p>-->
<!--    <strong>Показано:</strong>-->
<!--    <span th:text="${#lists.size(recentVisitors)}">20</span> записей-->
<!--    (страница <span th:text="${currentPage + 1}">1</span> из <span th:text="${totalPages}">3</span>)-->
<!--    | <strong>Всего записей в ограничении:</strong> <span th:text="${totalElements}">50</span>-->
<!--    | <a href="/analytics/visitors">📄 Посмотреть все записи →</a>-->
<!--</p>-->

<!--&lt;!&ndash; Размер страницы &ndash;&gt;-->
<!--<p>-->
<!--    <strong>Записей на странице:</strong>-->
<!--    <a th:href="@{/analytics(page=0, size=10)}"-->
<!--       th:style="${pageSize == 10} ? 'font-weight: bold; color: blue;' : ''">10</a> |-->
<!--    <a th:href="@{/analytics(page=0, size=20)}"-->
<!--       th:style="${pageSize == 20} ? 'font-weight: bold; color: blue;' : ''">20</a> |-->
<!--    <a th:href="@{/analytics(page=0, size=50)}"-->
<!--       th:style="${pageSize == 50} ? 'font-weight: bold; color: blue;' : ''">50</a>-->
<!--</p>-->

<!--&lt;!&ndash; Таблица посетителей &ndash;&gt;-->
<!--<div th:if="${recentVisitors != null and !recentVisitors.isEmpty()}">-->
<!--    <table border="1" cellpadding="5" width="100%">-->
<!--        <thead>-->
<!--        <tr style="background-color: #f5f5f5;">-->
<!--            <th width="15%">Время</th>-->
<!--            <th width="15%">IP Адрес</th>-->
<!--            <th width="20%">Локация</th>-->
<!--            <th width="15%">Устройство</th>-->
<!--            <th width="25%">Страница</th>-->
<!--            <th width="10%">Действия</th>-->
<!--        </tr>-->
<!--        </thead>-->
<!--        <tbody>-->
<!--        <tr th:each="visitor : ${recentVisitors}">-->
<!--            &lt;!&ndash; Время &ndash;&gt;-->
<!--            <td>-->
<!--                <strong th:text="${#temporals.format(visitor.visitTime, 'HH:mm:ss')}">12:34:56</strong>-->
<!--                <br>-->
<!--                <small th:text="${#temporals.format(visitor.visitTime, 'dd.MM.yyyy')}">15.08.2024</small>-->
<!--            </td>-->

<!--            &lt;!&ndash; IP адрес &ndash;&gt;-->
<!--            <td>-->
<!--                <a th:href="@{/analytics/ip(ip=${visitor.ipAddress})}">-->
<!--                    <code th:text="${visitor.ipAddress}">192.168.1.1</code>-->
<!--                </a>-->
<!--            </td>-->

<!--            &lt;!&ndash; Локация &ndash;&gt;-->
<!--            <td>-->
<!--                <strong th:text="${visitor.country ?: 'Невідомо'}">Ukraine</strong>-->
<!--                <span th:if="${visitor.isBot}" style="color: red;">🤖</span>-->
<!--                <br>-->
<!--                <small th:text="${visitor.city ?: 'Місто невідоме'}">Kyiv</small>-->
<!--            </td>-->

<!--            &lt;!&ndash; Устройство &ndash;&gt;-->
<!--            <td>-->
<!--                <span th:if="${visitor.isMobile}" style="color: green;">📱 Mobile</span>-->
<!--                <span th:unless="${visitor.isMobile}" style="color: blue;">💻 Desktop</span>-->
<!--                <br>-->
<!--                <small th:text="${visitor.operatingSystem ?: 'Unknown'}">Windows</small>-->
<!--            </td>-->

<!--            &lt;!&ndash; Страница &ndash;&gt;-->
<!--            <td>-->
<!--                <code style="font-size: 0.9em;" th:text="${visitor.requestedUrl ?: '/'}"></code>-->
<!--                <div th:if="${visitor.refererUrl}" style="margin-top: 3px;">-->
<!--                    <small style="color: gray;">-->
<!--                        від: <span th:text="${visitor.refererUrl}"></span>-->
<!--                    </small>-->
<!--                </div>-->
<!--            </td>-->

<!--            &lt;!&ndash; Действия &ndash;&gt;-->
<!--            <td style="text-align: center;">-->
<!--                <a th:href="@{/analytics/ip(ip=${visitor.ipAddress})}">🔍</a>-->
<!--            </td>-->
<!--        </tr>-->
<!--        </tbody>-->
<!--    </table>-->
<!--</div>-->

<!--&lt;!&ndash; Нет посетителей &ndash;&gt;-->
<!--<div th:if="${recentVisitors == null or recentVisitors.isEmpty()}">-->
<!--    <p style="color: orange; text-align: center; font-size: 1.2em;">-->
<!--        🚫 Поки немає відвідувачів-->
<!--    </p>-->
<!--    <p style="text-align: center;">В базі даних поки немає записів про відвідувачів.</p>-->
<!--</div>-->

<!--&lt;!&ndash; Пагинация &ndash;&gt;-->
<!--<div th:if="${totalPages > 1}">-->
<!--    <hr>-->
<!--    <h3>📄 Навигация по страницам</h3>-->
<!--    <p>-->
<!--        &lt;!&ndash; Предыдущая страница &ndash;&gt;-->
<!--        <span th:if="${hasPrevious}">-->
<!--                <a th:href="@{/analytics(page=${prevPage}, size=${pageSize})}">← Предыдущие</a>-->
<!--            </span>-->

<!--        &lt;!&ndash; Информация о странице &ndash;&gt;-->
<!--        <strong>-->
<!--            Страница <span th:text="${currentPage + 1}">1</span>-->
<!--            из <span th:text="${totalPages}">3</span>-->
<!--        </strong>-->

<!--        &lt;!&ndash; Следующая страница &ndash;&gt;-->
<!--        <span th:if="${hasNext}">-->
<!--                <a th:href="@{/analytics(page=${nextPage}, size=${pageSize})}">Следующие →</a>-->
<!--            </span>-->
<!--    </p>-->

<!--    &lt;!&ndash; Показать номера страниц &ndash;&gt;-->
<!--    <p>-->
<!--        <strong>Перейти:</strong>-->
<!--        <span th:each="i : ${#numbers.sequence(0, totalPages - 1)}">-->
<!--                <a th:if="${i != currentPage}"-->
<!--                   th:href="@{/analytics(page=${i}, size=${pageSize})}"-->
<!--                   th:text="${i + 1}">1</a>-->
<!--                <strong th:if="${i == currentPage}" th:text="${i + 1}">1</strong>-->
<!--                <span> </span>-->
<!--            </span>-->
<!--    </p>-->
<!--</div>-->

<!--&lt;!&ndash; Ошибки &ndash;&gt;-->
<!--<div th:if="${error}" style="color: red; border: 2px solid red; padding: 15px; margin: 10px 0; background-color: #ffe6e6;">-->
<!--    <h3>❌ Ошибка</h3>-->
<!--    <p th:text="${error}">Произошла ошибка загрузки аналитики</p>-->
<!--</div>-->

<!--<hr>-->

<!--&lt;!&ndash; Быстрые действия &ndash;&gt;-->
<!--<h3>🚀 Быстрые действия</h3>-->
<!--<ul>-->
<!--    <li><a href="/analytics/countries">🌍 Подробная статистика по странам</a></li>-->
<!--    <li><a href="/analytics/ip">🔍 Найти конкретный IP адрес</a></li>-->
<!--    <li><a href="/analytics/top-ips">👥 Посмотреть топ IP адресов</a></li>-->
<!--    <li><a href="/analytics/visitors">📄 Все посетители с полной пагинацией</a></li>-->
<!--</ul>-->

<!--<hr>-->

<!--&lt;!&ndash; Автообновление &ndash;&gt;-->
<!--<p style="text-align: center;">-->
<!--    <small style="color: gray;">-->
<!--        🔄 Страница автоматически обновится через <span id="countdown">60</span> секунд-->
<!--        | <button onclick="location.reload()">🔄 Обновить сейчас</button>-->
<!--    </small>-->
<!--</p>-->

<!--<script>-->
<!--    // Обратный отсчет и автообновление-->
<!--    let countdown = 60;-->
<!--    const countdownElement = document.getElementById('countdown');-->

<!--    setInterval(() => {-->
<!--        countdown&#45;&#45;;-->
<!--        countdownElement.textContent = countdown;-->

<!--        if (countdown <= 0) {-->
<!--            location.reload();-->
<!--        }-->
<!--    }, 1000);-->
<!--</script>-->

<!--</body>-->
<!--</html>-->


<!DOCTYPE html>
<html lang="uk" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Аналитика посетителей - Панель управления</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/css/bootstrap.min.css" rel="stylesheet">
    <!-- Custom styles -->
    <style>
        .stats-card {
            transition: transform 0.2s;
        }
        .stats-card:hover {
            transform: translateY(-2px);
        }
        .stats-number {
            font-size: 2.5rem;
            font-weight: bold;
        }
        @media (max-width: 576px) {
            .stats-number {
                font-size: 2rem;
            }
        }
        .table-responsive {
            font-size: 0.9rem;
        }
        @media (max-width: 576px) {
            .table-responsive {
                font-size: 0.8rem;
            }
        }
        .countdown-section {
            background-color: #f8f9fa;
            border-radius: 10px;
        }
    </style>
</head>
<body class="bg-light">

<div class="container-fluid py-3">
    <div class="row">
        <div class="col-12">
            <h1 class="display-6 text-center mb-4">📊 Аналитика посетителей</h1>

            <!-- Навигация -->
            <nav class="navbar navbar-expand-lg navbar-light bg-white rounded shadow-sm mb-4">
                <div class="container-fluid">
                    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                        <span class="navbar-toggler-icon"></span>
                    </button>
                    <div class="collapse navbar-collapse" id="navbarNav">
                        <ul class="navbar-nav mx-auto">
                            <li class="nav-item">
                                <a class="nav-link" href="/analytics/countries">🌍 Страны</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" href="/analytics/ip">🔍 Поиск по IP</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" href="/analytics/top-ips">👥 Топ IP</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" href="/analytics/visitors">📄 Все посетители</a>
                            </li>
                        </ul>
                    </div>
                </div>
            </nav>

            <!-- Основная статистика -->
            <h2 class="h4 mb-3">📈 Основная статистика</h2>
            <div class="row g-3 mb-4">
                <div class="col-6 col-md-3">
                    <div class="card stats-card h-100 bg-primary bg-opacity-10 border-primary">
                        <div class="card-body text-center">
                            <h5 class="card-title">👥 Всего</h5>
                            <div class="stats-number text-primary" th:text="${stats.totalVisits ?: 0}">1,234</div>
                            <small class="text-muted">За все время</small>
                        </div>
                    </div>
                </div>
                <div class="col-6 col-md-3">
                    <div class="card stats-card h-100 bg-success bg-opacity-10 border-success">
                        <div class="card-body text-center">
                            <h5 class="card-title">📅 За неделю</h5>
                            <div class="stats-number text-success" th:text="${stats.weeklyVisits ?: 0}">156</div>
                            <small class="text-muted">Последние 7 дней</small>
                        </div>
                    </div>
                </div>
                <div class="col-6 col-md-3">
                    <div class="card stats-card h-100 bg-warning bg-opacity-10 border-warning">
                        <div class="card-body text-center">
                            <h5 class="card-title">📱 Мобильных</h5>
                            <div class="stats-number text-warning" th:text="${#numbers.formatDecimal(stats.mobilePercentage ?: 0, 1, 1)} + '%'">45.2%</div>
                            <small class="text-muted">От всех посещений</small>
                        </div>
                    </div>
                </div>
                <div class="col-6 col-md-3">
                    <div class="card stats-card h-100 bg-info bg-opacity-10 border-info">
                        <div class="card-body text-center">
                            <h5 class="card-title">🕐 Сегодня</h5>
                            <div class="stats-number text-info" th:text="${todayVisits ?: 0}">23</div>
                            <small class="text-muted">Уникальных: <span th:text="${todayUnique ?: 0}">15</span></small>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Топ страны и страницы -->
            <div class="row g-3 mb-4">
                <!-- Топ страны -->
                <div class="col-12 col-lg-6">
                    <div class="card h-100">
                        <div class="card-header">
                            <h5 class="card-title mb-0">🌍 Топ страны (неделя)</h5>
                        </div>
                        <div class="card-body">
                            <div th:if="${topCountries != null and !topCountries.isEmpty()}">
                                <div class="table-responsive">
                                    <table class="table table-hover">
                                        <thead class="table-light">
                                        <tr>
                                            <th>Место</th>
                                            <th>Страна</th>
                                            <th class="text-end">Посещений</th>
                                        </tr>
                                        </thead>
                                        <tbody>
                                        <tr th:each="country, countryStat : ${topCountries}">
                                            <td>
                                                <span class="badge bg-secondary" th:text="${countryStat.count}">1</span>
                                            </td>
                                            <td>
                                                    <span th:switch="${country[0]}">
                                                        <span th:case="'Ukraine'">🇺🇦</span>
                                                        <span th:case="'Poland'">🇵🇱</span>
                                                        <span th:case="'Germany'">🇩🇪</span>
                                                        <span th:case="'United States'">🇺🇸</span>
                                                        <span th:case="'Canada'">🇨🇦</span>
                                                        <span th:case="'France'">🇫🇷</span>
                                                        <span th:case="*">🌍</span>
                                                    </span>
                                                <span th:text="${country[0] ?: 'Невідомо'}">Ukraine</span>
                                            </td>
                                            <td class="text-end">
                                                <strong th:text="${country[1]}">45</strong>
                                            </td>
                                        </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                            <div th:if="${topCountries == null or topCountries.isEmpty()}" class="text-center text-muted">
                                <p>Поки немає даних по країнах</p>
                            </div>
                            <div class="card-footer bg-transparent">
                                <a href="/analytics/countries" class="btn btn-outline-primary btn-sm">📊 Детальна статистика →</a>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Топ страницы -->
                <div class="col-12 col-lg-6">
                    <div class="card h-100">
                        <div class="card-header">
                            <h5 class="card-title mb-0">📄 Популярні сторінки</h5>
                        </div>
                        <div class="card-body">
                            <div th:if="${topPages != null and !topPages.isEmpty()}">
                                <div class="table-responsive">
                                    <table class="table table-hover">
                                        <thead class="table-light">
                                        <tr>
                                            <th>Место</th>
                                            <th>Страница</th>
                                            <th class="text-end">Посещений</th>
                                        </tr>
                                        </thead>
                                        <tbody>
                                        <tr th:each="page, pageStat : ${topPages}">
                                            <td>
                                                <span class="badge bg-secondary" th:text="${pageStat.count}">1</span>
                                            </td>
                                            <td>
                                                <code class="text-break" th:text="${page[0] ?: '/'}"></code>
                                            </td>
                                            <td class="text-end">
                                                <strong th:text="${page[1]}">12</strong>
                                            </td>
                                        </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                            <div th:if="${topPages == null or topPages.isEmpty()}" class="text-center text-muted">
                                <p>Поки немає даних по сторінках</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Последние посетители -->
            <div class="card mb-4">
                <div class="card-header d-flex justify-content-between align-items-center flex-wrap">
                    <h5 class="card-title mb-0">👥 Останні відвідувачі</h5>
                    <div class="mt-2 mt-md-0">
                        <small class="text-muted">
                            Показано: <span th:text="${#lists.size(recentVisitors)}">20</span> записей
                            (страница <span th:text="${currentPage + 1}">1</span> из <span th:text="${totalPages}">3</span>)
                        </small>
                    </div>
                </div>

                <div class="card-body">
                    <!-- Размер страницы -->
                    <div class="mb-3">
                        <span class="me-2">Записей на странице:</span>
                        <div class="btn-group btn-group-sm" role="group">
                            <a th:href="@{/analytics(page=0, size=10)}"
                               th:class="${pageSize == 10} ? 'btn btn-primary' : 'btn btn-outline-primary'">10</a>
                            <a th:href="@{/analytics(page=0, size=20)}"
                               th:class="${pageSize == 20} ? 'btn btn-primary' : 'btn btn-outline-primary'">20</a>
                            <a th:href="@{/analytics(page=0, size=50)}"
                               th:class="${pageSize == 50} ? 'btn btn-primary' : 'btn btn-outline-primary'">50</a>
                        </div>
                        <a href="/analytics/visitors" class="btn btn-outline-secondary btn-sm ms-2">📄 Все записи</a>
                    </div>

                    <!-- Таблица посетителей -->
                    <div th:if="${recentVisitors != null and !recentVisitors.isEmpty()}">
                        <!-- Мобильная версия (карточки) -->
                        <div class="d-block d-md-none">
                            <div th:each="visitor : ${recentVisitors}" class="card mb-3 border-start border-primary border-3">
                                <div class="card-body">
                                    <div class="row">
                                        <div class="col-6">
                                            <strong th:text="${#temporals.format(visitor.visitTime, 'HH:mm:ss')}">12:34:56</strong>
                                            <br><small class="text-muted" th:text="${#temporals.format(visitor.visitTime, 'dd.MM.yyyy')}">15.08.2024</small>
                                        </div>
                                        <div class="col-6 text-end">
                                            <a th:href="@{/analytics/ip(ip=${visitor.ipAddress})}" class="btn btn-outline-primary btn-sm">
                                                🔍 <span th:text="${visitor.ipAddress}">IP</span>
                                            </a>
                                        </div>
                                    </div>
                                    <hr class="my-2">
                                    <div class="row">
                                        <div class="col-6">
                                            <strong th:text="${visitor.country ?: 'Невідомо'}">Ukraine</strong>
                                            <span th:if="${visitor.isBot}" class="text-danger">🤖</span>
                                            <br><small th:text="${visitor.city ?: 'Місто невідоме'}">Kyiv</small>
                                        </div>
                                        <div class="col-6 text-end">
                                            <span th:if="${visitor.isMobile}" class="text-success">📱 Mobile</span>
                                            <span th:unless="${visitor.isMobile}" class="text-primary">💻 Desktop</span>
                                            <br><small th:text="${visitor.operatingSystem ?: 'Unknown'}">Windows</small>
                                        </div>
                                    </div>
                                    <hr class="my-2">
                                    <div>
                                        <code class="text-break small" th:text="${visitor.requestedUrl ?: '/'}"></code>
                                        <div th:if="${visitor.refererUrl}" class="mt-1">
                                            <small class="text-muted">
                                                від: <span class="text-break" th:text="${visitor.refererUrl}"></span>
                                            </small>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Десктопная версия (таблица) -->
                        <div class="d-none d-md-block table-responsive">
                            <table class="table table-hover">
                                <thead class="table-light">
                                <tr>
                                    <th>Время</th>
                                    <th>IP Адрес</th>
                                    <th>Локация</th>
                                    <th>Устройство</th>
                                    <th>Страница</th>
                                    <th class="text-center">Действия</th>
                                </tr>
                                </thead>
                                <tbody>
                                <tr th:each="visitor : ${recentVisitors}">
                                    <td>
                                        <strong th:text="${#temporals.format(visitor.visitTime, 'HH:mm:ss')}">12:34:56</strong>
                                        <br><small class="text-muted" th:text="${#temporals.format(visitor.visitTime, 'dd.MM.yyyy')}">15.08.2024</small>
                                    </td>
                                    <td>
                                        <a th:href="@{/analytics/ip(ip=${visitor.ipAddress})}">
                                            <code th:text="${visitor.ipAddress}">192.168.1.1</code>
                                        </a>
                                    </td>
                                    <td>
                                        <strong th:text="${visitor.country ?: 'Невідомо'}">Ukraine</strong>
                                        <span th:if="${visitor.isBot}" class="text-danger">🤖</span>
                                        <br><small th:text="${visitor.city ?: 'Місто невідоме'}">Kyiv</small>
                                    </td>
                                    <td>
                                        <span th:if="${visitor.isMobile}" class="text-success">📱 Mobile</span>
                                        <span th:unless="${visitor.isMobile}" class="text-primary">💻 Desktop</span>
                                        <br><small th:text="${visitor.operatingSystem ?: 'Unknown'}">Windows</small>
                                    </td>
                                    <td>
                                        <code class="small text-break" th:text="${visitor.requestedUrl ?: '/'}"></code>
                                        <div th:if="${visitor.refererUrl}" class="mt-1">
                                            <small class="text-muted">
                                                від: <span class="text-break" th:text="${visitor.refererUrl}"></span>
                                            </small>
                                        </div>
                                    </td>
                                    <td class="text-center">
                                        <a th:href="@{/analytics/ip(ip=${visitor.ipAddress})}" class="btn btn-outline-primary btn-sm">🔍</a>
                                    </td>
                                </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>

                    <!-- Нет посетителей -->
                    <div th:if="${recentVisitors == null or recentVisitors.isEmpty()}" class="text-center text-warning my-4">
                        <h4>🚫 Поки немає відвідувачів</h4>
                        <p>В базі даних поки немає записів про відвідувачів.</p>
                    </div>

                    <!-- Пагинация -->
                    <div th:if="${totalPages > 1}">
                        <nav aria-label="Навигация по страницам">
                            <ul class="pagination justify-content-center flex-wrap">
                                <li th:class="${hasPrevious} ? 'page-item' : 'page-item disabled'">
                                    <a th:if="${hasPrevious}"
                                       th:href="@{/analytics(page=${prevPage}, size=${pageSize})}"
                                       class="page-link">← Предыдущие</a>
                                    <span th:unless="${hasPrevious}" class="page-link">← Предыдущие</span>
                                </li>

                                <span th:each="i : ${#numbers.sequence(0, totalPages - 1)}">
                                    <li th:class="${i == currentPage} ? 'page-item active' : 'page-item'">
                                        <a th:if="${i != currentPage}"
                                           th:href="@{/analytics(page=${i}, size=${pageSize})}"
                                           class="page-link" th:text="${i + 1}">1</a>
                                        <span th:if="${i == currentPage}"
                                              class="page-link" th:text="${i + 1}">1</span>
                                    </li>
                                </span>

                                <li th:class="${hasNext} ? 'page-item' : 'page-item disabled'">
                                    <a th:if="${hasNext}"
                                       th:href="@{/analytics(page=${nextPage}, size=${pageSize})}"
                                       class="page-link">Следующие →</a>
                                    <span th:unless="${hasNext}" class="page-link">Следующие →</span>
                                </li>
                            </ul>
                        </nav>
                    </div>
                </div>
            </div>

            <!-- Ошибки -->
            <div th:if="${error}" class="alert alert-danger alert-dismissible fade show" role="alert">
                <h5 class="alert-heading">❌ Ошибка</h5>
                <p th:text="${error}" class="mb-0">Произошла ошибка загрузки аналитики</p>
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            </div>

            <!-- Быстрые действия -->
            <div class="card mb-4">
                <div class="card-header">
                    <h5 class="card-title mb-0">🚀 Быстрые действия</h5>
                </div>
                <div class="card-body">
                    <div class="row g-2">
                        <div class="col-6 col-md-3">
                            <a href="/analytics/countries" class="btn btn-outline-primary w-100">
                                <small>🌍 Статистика по странам</small>
                            </a>
                        </div>
                        <div class="col-6 col-md-3">
                            <a href="/analytics/ip" class="btn btn-outline-info w-100">
                                <small>🔍 Поиск IP</small>
                            </a>
                        </div>
                        <div class="col-6 col-md-3">
                            <a href="/analytics/top-ips" class="btn btn-outline-success w-100">
                                <small>👥 Топ IP</small>
                            </a>
                        </div>
                        <div class="col-6 col-md-3">
                            <a href="/analytics/visitors" class="btn btn-outline-warning w-100">
                                <small>📄 Все посетители</small>
                            </a>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Автообновление -->
            <div class="countdown-section p-3 text-center">
                <small class="text-muted">
                    🔄 Страница автоматически обновится через <span id="countdown" class="fw-bold">60</span> секунд
                </small>
                <br>
                <button onclick="location.reload()" class="btn btn-sm btn-outline-secondary mt-2">🔄 Обновить сейчас</button>
            </div>
        </div>
    </div>
</div>

<!-- Bootstrap JS -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/js/bootstrap.bundle.min.js"></script>

<script>
    // Обратный отсчет и автообновление
    let countdown = 60;
    const countdownElement = document.getElementById('countdown');

    setInterval(() => {
        countdown--;
        countdownElement.textContent = countdown;

        if (countdown <= 0) {
            location.reload();
        }
    }, 1000);
</script>

</body>
</html>